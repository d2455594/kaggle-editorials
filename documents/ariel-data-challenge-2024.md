---
tags:
  - Kaggle
startdate: 2024-08-02
enddate: 2024-11-01
---
# NeurIPS - Ariel Data Challenge 2024
https://www.kaggle.com/competitions/ariel-data-challenge-2024

**全体的な傾向**

上位解法は、系外惑星のトランジット深度をノイズの多い分光信号から推定する課題に取り組みました。物理モデルに基づいたアプローチ（ベイズ推論、多項式フィッティング）と、データ駆動型のアプローチ（ガウス過程回帰、オートエンコーダ、非負値行列因子分解）の両方が見られました。信号のキャリブレーション、ノイズ除去、トランジット区間の正確な検出、波長間の相関の考慮、そして不確実性の推定が重要なテクニックとして用いられました。

**各解法の詳細**

**1位**

- **アプローチ:** データ生成に使用されたシミュレータ（ExoSim2、TauREx3）のコードを深く分析し、ゲイン変動のフィッティングや前景処理などの重要な要素を特定。物理モデルに基づいたフィッティングと、波長間の相関を考慮した機械学習モデルのアンサンブル。
- **アーキテクチャ:** ゲイン変動フィッティングのための多項式関数、トランジット深度推定のためのボックス関数、波長相関を考慮するためのガウス過程回帰（GPR）、オートエンコーダ、非負値行列因子分解（NMF）。
- **アルゴリズム:** ベイズ推論、ガウス過程回帰（RBFカーネル、Maternカーネル）、自己符号化器（4ノードの隠れ層）、非負値行列因子分解（ランク5）、ブートストラップ法（誤差推定）、RANSAC（外れ値除去 - 別のコンペの話が混入している可能性あり）。
- **テクニック:**
    - **信号前処理:** AIRS-CH0チャンネルのみを使用。ホットピクセル処理の無効化、前景処理（波長依存の信号推定と除去）。
    - **初期ディップ推定:** 波長平均信号によるトランジット区間の特定（ルールベースとフィッティング）、ゲイン変動のモデル化（時間と波長の分離可能な多項式）、ゲイン変動を考慮したディップ推定（二段階フィッティング）。
    - **波長相関の考慮:** GPR、オートエンコーダ、NMFによるディップスペクトルの洗練。
    - **不確実性の推定:** ブートストラップ法によるディップ誤差の推定。
    - **アンサンブル:** GPR、オートエンコーダ、NMFの予測を重み付け平均（6:2:2）。

**2位**

- **アプローチ:** ベイズ推論とガウス過程（GP）を組み合わせた純粋なベイズ的アプローチ。物理現象を記述する事前分布と観測データを組み合わせ、事後分布からトランジット深度を推定。
- **アーキテクチャ:** ノイズ、恒星スペクトル、1次元ドリフト（時間）、2次元ドリフト（時間と波長）、トランジットウィンドウ（固定関数）、トランジット深度（平均、FGS変動、AIRS変動（GP）、PCA成分）を要素とする階層的な事前分布。
- **アルゴリズム:** ベイズ推論、ガウス過程（多重二乗指数カーネル）、KISS-GP（疎なGP）、主成分分析（PCA）、最尤推定（ハイパーパラメータチューニング）、勾配降下法（トランジット深度の大きさのチューニング）。
- **テクニック:**
    - **事前分布の定義:** 各物理要素を確率分布として記述（GPによる滑らかな関数を含む）。
    - **ハイパーパラメータのチューニング:** トレーニングデータでGPのハイパーパラメータを調整。推論時にはトランジット深度の大きさのみを調整。
    - **疎なGP:** スペクトルドリフトにKISS-GPを適用。
    - **PCA:** 惑星ごとのトランジット深度の共通形状を抽出。
    - **トランジットウィンドウ:** トレーニングデータから得られた固定関数を使用し、幅、イングレス時間、イグレス時間をフィッティング。
    - **恒星スペクトル:** 波長ごとに独立したガウス分布。
    - **事後分布の探索:** パラメータの初期推測、線形化、標準的なGPソルバーの適用を繰り返す反復法。

**3位**

- **アプローチ:** 多項式フィッティングと主成分分析（PCA）を組み合わせたアプローチ。信号のプレ処理、生スペクトル値の抽出、スペクトルの後処理とシグマ推定、PCAによる最終的なスペクトルの洗練。
- **アーキテクチャ:** 多項式関数（最大5次）、ガウシアン関数、savgolフィルタ。
- **アルゴリズム:** 多項式フィッティング（scipy.optimize.curve_fit）、ガウス畳み込み、savgolフィルタリング、主成分分析（PCA）。
- **テクニック:**
    - **データ前処理:** 主催者提案のキャリブレーションをベースに、ホットピクセル保持、高強度ピクセルのみ使用、AIRS-CH0のビニング削減。SNRに基づいた波長重み付け、デッドピクセル軽減。
    - **生スペクトル値の抽出:** 多項式フィッティングによるトレンド除去とトランジット深度の推定、隣接波長での加重平均、ガウス関数の微分によるイングレス/イグレス遷移の検出、RMS誤差に基づいた多項式次数の選択、狭い波長範囲でのグローバルデトレンドと推定。
    - **スペクトル後処理とシグマ推定:** スペクトルのダイナミクスに基づいた後処理とシグマ推定（低ダイナミクスは平均予測線、高ダイナミクスは生スペクトルを調整）、オフセット補正、スペクトルの適応（クリッピング、ランプ化）、経験的なシグマ構築。
    - **最終スペクトルの洗練:** PCAを適用して残差ノイズとアーティファクトを除去。

**4位**

- **アプローチ:** 多項式近似をベースとしたアプローチ。イングレス/イグレスの開始/終了を推定するための改良された多項式フィッティング、バイナリサーチによる最適化、イングレスとイグレスを別々にフィッティング。
- **アーキテクチャ:** 2次および3次の多項式関数。
- **アルゴリズム:** 多項式フィッティング、バイナリサーチ、線形回帰。
- **テクニック:**
    - **イングレス/イグレスの推定:** 信号を半分に分割し、2つの点を定義して、開始から最初の点、2番目の点から信号の半分まで、およびそれらを接続する線形関数で2次多項式をフィッティング。RMSEを最小化するように点の位置を探索。
    - **予測の改善:** イングレス/イグレス前後の信号を多項式で推定。波長平均信号を使用。
    - **シグマ推定:** 惑星ごとの平均シグマと、予測の最大値と最小値の差の間の相関関係を利用。閾値に基づいて異なる平均シグマを予測し、線形回帰で補間。2D多項式フィッティングによるシグマ推定（予測の標準偏差とイングレス/イグレス予測の差を使用）。
    - **予測の補正:** 平均予測とターゲットの差の線形回帰による補正。
    - **波長ごとの予測:** 予測の変動が大きい場合に波長ごとの予測を有効化。ノイズの多い長波長を平均予測で置換。平均信号に変動を追加。予測の標準偏差に基づいて平滑化と変動を調整。

**5位**

- **アプローチ:** 多項式フィッティングによるトレンド除去、波長特徴量の抽出、線形回帰モデル。公開ノートブックをベースに、データ前処理の高速化、欠損値補完、波長特徴量の抽出、シグマ推定の改善、合成データの利用。
- **アーキテクチャ:** 線形回帰モデル、ガウス関数、マルコフ連鎖モンテカルロ法（MCMC - ランタイムのため未使用）、全結合ニューラルネットワーク（シグマ推定）。
- **アルゴリズム:** 多項式フィッティング、ガウス関数フィッティング、スライディングウィンドウ法（吸収スペクトル抽出）、2Dガウス+MCMC、線形回帰、完全結合NN。
- **テクニック:**
    - **データ前処理:** ホットピクセルとデッドピクセルの補完、GPUと並列処理による高速化。
    - **光度曲線モデリング:** 多項式フィッティングによるドリフト除去とトランジット深度の推定（平均予測とLBスコアで調整されたシグマを使用）。トランジットポイントの除外による安定化。
    - **波長特徴量:** スライディングウィンドウによる吸収スペクトルの抽出、ガウス関数による吸収ピークのモデリング、線形回帰モデルへの集約。
    - **シグマ推定:** 予測の標準偏差と誤差の強い相関、NNによるシグマ予測とブレンド。
    - **合成データ:** Taurex3で生成した9つの追加分子の吸収スペクトルによるデータ拡張。トレーニングラベルへの追加とクリーン信号への追加。

**6位**

- **アプローチ:** ヒューリスティックとCNNの組み合わせ。外れ値平滑化、SGフィルタリング、トランジットゾーン予測、特徴量構築、平均シグマ推定。
- **アーキテクチャ:** CNN（2ヘッド：スペクトル予測、平均シグマ予測）。
- **アルゴリズム:** ガウシアンフィルタリング、SGフィルタリング、遺伝的アルゴリズム（特徴量選択）、GaussianLoss（CNN）。
- **テクニック:**
    - **データ処理:** ピクセルデータの外れ値をガウス関数で平滑化。
    - **平滑化:** SGフィルタリングを適用。
    - **トランジットゾーン予測:** SGフィルタリングと勾配に基づいて境界を検出。
    - **特徴量:** 多項式フィッティング、周波数合計、周波数間隔の係数。
    - **シグマ推定:** 惑星ごとの平均シグマを予測（最大予測と最小予測の差からの回帰）。
    - **モデル:** ヒューリスティック（重み付き特徴量）、CNN（2ヘッド、GaussianLoss）。
    - **ミキシング:** トレーニングセットのRMSEに基づいて重みを選択。

**7位**

- **アプローチ:** Sergeiの多項式回帰法をベースとしたトランジット深度のフィッティング。ヒューリスティックなトランジット検出、平均トランジットの予測、個々の波長の予測、シグマ推定。
- **テクニック:**
    - **トランジット検出:** 信号の一次微分とガウス畳み込みに基づいて臨界点を検出し、多項式とトランジット深度をフィッティング。臨界点からの距離に基づいてイングレス/イグレス時間を推定。
    - **平均トランジット予測:** 波長平均、ガウシアンフィルタリング、異なる次数の多項式フィッティングの平均。
    - **基本的なデータ処理:** NaN値の補完（空間対称平均、波長内挿）。
    - **個々の波長予測:** 波長軸に沿った畳み込み（窓サイズは信号のMAEに基づく）。
    - **シグマ推定:** フィッティングされた多項式曲線と未処理信号の残差のMAEに基づく。スペクトルの平坦度に基づく。
    - **フラットカーブの予測:** スペクトルカーブがフラットかどうかを予測し、フラットな場合は平均トランジットと低い標準偏差を予測。

**8位**

- **アプローチ:** 多項式フィッティングとSVD（特異値分解）に基づくアプローチ。段階的なフェーズ分割、複数のモデル、アンサンブル、ポスト処理。
- **テクニック:**
    - **データ処理:** 最後の60波長を除去。
    - **フェーズ分割:** 多項式フィッティングによるトレンド除去、勾配累積によるギャップ中心の検出、単調性条件に基づく正確なギャップ端の検出。
    - **モデル1:** OLS（最小二乗法）によるトランジット深度の直接推定（平均波長でフィッティング、外れ値除去）。
    - **モデル2:** SVDによる波長の再構成（SNRに基づいて重み付け）、指数平滑化、OLSによる独立した波長のフィッティング、係数共分散の推定。
    - **アンサンブル:** 異なるビニングサイズの結果の平均。
    - **ポスト処理:** SVDによる係数の主要成分の抽出とGLS（一般化最小二乗法）による再構成、バイアス補正、モデル間の差と係数標準誤差に基づくシグマ推定。

**9位**

- **アプローチ:** 多項式フィッティング（Sergeiの方法の修正版）と差分に基づく粗いトランジット深度の推定、簡単なシグマ推定、重み付き平均による最終予測。
- **テクニック:**
    - **データ前処理:** ホットピクセル処理とビニングを省略。3位解法と同様に一次微分と二次微分に基づいて信号を分割。
    - **μの粗い推定:** 多項式フィッティング（Sergeiの方法の修正版）と差分に基づくトランジット中の相対的な信号低下を推定。全282波長での平均μと、47チャンク（各6ピクセル）での個別波長のμを計算。
    - **σの推定:** 4チャンクのμの標準偏差をσとする簡単な方法。
    - **μの洗練:** 全体平均μと47チャンクのμを、推定されたσに基づいて重み付け平均。

**10位**

- **アプローチ:** 多項式近似。トランジットの入り口/出口の瞬間を切り取らずに、信号全体を使用。
- **テクニック:**
    - **トランジットゾーン検出:** スライディングウィンドウでの導関数計算による強度変化の検出、導関数の極値に基づくトランジットの中点の推定、線形セクションによるトランジット開始の正確な決定。
    - **トランジット回復関数:** 滑らかな関数（Desmosで定義）によるトランジットのモデル化。
    - **予測収集パイプライン:** 波長ビニング集約とランダムサンプルインデックス選択によるターゲットの計算、トランジットの開始/終了/期間のパラメータ計算、正規化された信号での多項式フィッティング、波長インデックスの反復処理とサブサンプルの最適化、ノイズの多い波長の予測。
    - **シグマ推定:** 勾配ブースティングによる予測特徴量からのシグマ推定（「良い」波長と「ノイズの多い」波長で別々に予測）。