---
tags:
  - Kaggle
startdate: 2023-02-17
enddate: 2023-05-19
---
# AMP®-Parkinson's Disease Progression Prediction
[https://www.kaggle.com/competitions/amp-parkinsons-disease-progression-prediction](https://www.kaggle.com/competitions/amp-parkinsons-disease-progression-prediction)

**概要 (Overview)**

* **目的:** このコンペティションの目的は、臨床評価データと血液（血漿）プロテオミクス（タンパク質/ペプチド）データを用いて、**パーキンソン病 (PD) 患者の疾患進行度を予測する**モデルを開発することです。具体的には、Unified Parkinson's Disease Rating Scale (UPDRS) の4つのサブスコア（UPDRS 1, 2, 3, 4）を、将来の複数の時点（6ヶ月後、12ヶ月後、24ヶ月後など）について予測します。
* **背景:** パーキンソン病は進行性の神経変性疾患であり、その進行速度は患者ごとに大きく異なります。疾患進行を正確に予測することは、個別化治療計画の立案や新しい治療法の臨床試験設計において非常に重要です。Accelerating Medicines Partnership® (AMP®) PDプログラムは、客観的なバイオマーカー（特に血液プロテオミクス）と臨床データを組み合わせることで、疾患進行の理解を深め、治療法開発を加速することを目指しています。
* **課題:**
    * **疾患の異質性:** パーキンソン病の進行パターンは患者間で多様です。
    * **データの縦断性:** 患者データは複数回の訪問にわたって収集されており、時間的な依存関係を考慮する必要があります。
    * **マルチモーダルデータ:** 臨床評価 (UPDRS) と高次元のプロテオミクスデータを効果的に統合する必要があります。
    * **将来予測:** 現在および過去のデータから、数ヶ月～数年先の状態を予測する必要があります。
    * **データの複雑性:** プロテオミクスデータは高次元であり、ノイズや欠損値を含む可能性があります。UPDRSスコアも評価者による主観性を含む場合があります。
    * **評価指標:** SMAPE+1という特殊な指標で評価され、スケールの異なる複数のターゲットを同時に最適化する必要があります。

**データセットの形式 (Dataset Format)**

提供される主なデータは、複数回の訪問における臨床評価データとプロテオミクスデータです。

1.  **トレーニングデータ:**
    * **`train_clinical_data.csv`:**
        * 各行が患者の1回の訪問に対応します。
        * `patient_id`: 患者ID。
        * `visit_id`: 訪問ID (`patient_id` + `_` + `visit_month`)。
        * `visit_month`: ベースライン (初回訪問) からの月数。
        * `updrs_1`, `updrs_2`, `updrs_3`, `updrs_4`: **ターゲット変数**となるUPDRSの各パートのスコア。UPDRS 4は一部の訪問でのみ測定されます。
        * `upd23b_clinical_state_on_medication`: 投薬状況（On/Off）。UPDRS 3に関連。
    * **`train_proteins.csv`:**
        * 血漿タンパク質測定値。
        * `visit_id`, `patient_id`, `visit_month`: 臨床データと紐づけるためのキー。
        * `UniProt`: タンパク質ID。
        * `NPX`: 正規化されたタンパク質発現レベル。
    * **`train_peptides.csv`:**
        * 血漿ペプチド測定値。
        * `visit_id`, `patient_id`, `visit_month`: 臨床データと紐づけるためのキー。
        * `UniProt`, `PeptideAbundance`: ペプチドIDと存在量。
    * **`supplemental_clinical_data.csv`:** 追加の臨床データ。フォーマットは `train_clinical_data.csv` と同様ですが、テストセットの患者は含まれていないとされています。
2.  **テストデータ:**
    * テストデータは隠されており、APIを通じて提供されます。参加者は提供されたテストデータ（最新の訪問データ）に基づいて、指定された将来の時点（訪問月から+6, +12, +24ヶ月など）のUPDRS 1-4スコアを予測します。
    * テスト用のプロテオミクスデータ (`test_proteins.csv`, `test_peptides.csv`) もAPI経由で提供されます。
    * **`sample_submission.csv`:** 提出フォーマットのサンプル。
        * `prediction_id`: 予測対象を示すID (`visit_id` + `_` + `target_updrs` + `_plus_` + `prediction_month`)。
        * `rating`: 予測されるUPDRSスコア。
        * グループ化のための `group_key` も含まれます。

**評価指標 (Evaluation Metric)**

* **指標:** **SMAPE+1 (Symmetric Mean Absolute Percentage Error + 1)**
* **計算方法:**
    * 各予測ターゲット（特定の患者、特定のUPDRSパート、特定の予測月）についてSMAPE+1を計算します。
    SMAPE+1 = 100 * |予測値 - 実測値| / ((|予測値| + |実測値|) / 2 + 1)
    * 全ての予測ターゲットに対するSMAPE+1の平均値が最終スコアとなります。
* **意味:** 予測値と実測値の間の相対的な誤差を測る指標です。絶対誤差を予測値と実測値の平均（の絶対値）で割ることで、スケールの影響を受けにくくしています。分母に+1を加えることで、実測値と予測値がともに0に近い場合にゼロ除算や不安定な値になるのを防ぎます。スコアは **0に近い** ほど性能が良いことを示します。この指標は、UPDRS 1-4のように値の範囲が異なる複数のターゲットを同時に評価するのに適しています。

要約すると、このコンペティションは、臨床データとプロテオミクスデータを用いて、パーキンソン病患者の将来のUPDRSスコア（4種類）を予測する時系列予測タスクです。データは縦断的な訪問記録で構成され、性能はSMAPE+1（0に近いほど良い）によって評価されます。

---

**全体的な傾向**

パーキンソン病の進行予測というこのコンペティションでは、驚くべきことに、**多くのトップチームが血液検査データ（タンパク質/ペプチド）を最終的なモデルにほとんど、あるいは全く使用しませんでした**。これらのデータから予測性能を向上させる安定したシグナルを見つけることが非常に困難であったと報告されています。一部チームは特徴量として利用したり、間接的に（例: 患者グルーピングのためのラベル生成）利用しましたが、主要な予測因子とはなりませんでした。

代わりに、**臨床データ、特に訪問スケジュールに関連する特徴量**が非常に重要であることが判明しました。
* **訪問月 (`visit_month`)** そのもの。
* **予測対象月までの期間 (`prediction_month`)**。
* **患者の訪問パターン:**
    * 6ヶ月目や18ヶ月目といった早期の追加訪問の有無。
    * 訪問間隔（特に最小訪問間隔が6ヶ月か12ヶ月か）。
    * これまでの訪問回数。
これらの情報が、患者の疾患進行度（≒UPDRSスコア）と強く相関していることが発見されました。特に、**早期（6ヶ月目など）に頻繁な訪問がある患者は、そうでない患者（年1回訪問など、コントロール群の可能性）よりもUPDRSスコアが高い傾向**があり、この違いをモデルに取り込むことがスコア向上の鍵となりました。

モデルとしては、**LightGBM (LGBM)** や **多層パーセプトロン (MLP)** などのテーブルデータで実績のあるものが主流でした。**サポートベクターリグレッション (SVR)** や単純な**線形回帰**、**Isotonic Regression** も用いられました。

特徴的なアプローチとして、
* **LGBMを分類問題として解く:** UPDRSスコアの取りうる整数値をクラスラベルとし、予測確率分布から評価指標(SMAPE+1)を直接最小化する値を後処理で選択する。
* **MLPで評価指標を直接最適化:** SMAPE+1を損失関数としてNNを学習する。
* **患者グルーピング:** 訪問パターン（例: 最小訪問間隔）に基づいて患者をグループ分けし、グループごとに異なるモデルやパラメータを適用する。
* **データ構造の変換:** 予測対象（4つのUPDRS x 4つの予測期間 = 16ターゲット）をワイドフォーマットで扱うか、予測期間を特徴量としてロングフォーマットで扱うか。

データ量が少ないため、**Cross Validation (CV) 戦略**が重要視されました。特に患者IDに基づいたGroupKFoldやLeave-One-Patient-Out CVが用いられました。ただし、Public Leaderboard (LB) との相関は必ずしも高くなく、最終的なモデル選択には注意が必要でした。

**各解法の詳細**

**[1位](https://www.kaggle.com/competitions/amp-parkinsons-disease-progression-prediction/discussion/412667)**

* **アプローチ:** LGBM (分類) と MLP (回帰) の単純平均アンサンブル。**血液検査データ未使用**。
* **アーキテクチャ:** LGBM (多クラス分類)、MLP (多層フィードフォワード)。
* **アルゴリズム:** LGBM: LogLoss。MLP: SMAPE+1 Loss。
* **テクニック:**
    * **特徴量:** 訪問月、予測期間、予測対象月、血液採取有無フラグ、補足データフラグ、特定月(6, 18, 48)訪問フラグ、過去の非定例訪問(6, 18)回数、ターゲットインデックス。
    * **LGBM後処理:** 予測確率分布からSMAPE+1を最小化する整数値を探索。
    * **NN後処理:** 最終層にLeaky ReLUを適用し負の予測値を防止。
    * **CV:** Leave-One-Patient-Out CV。
    * **キーポイント:** 6ヶ月目/18ヶ月目の訪問有無が非常に重要。

**[2位](https://www.kaggle.com/competitions/amp-parkinsons-disease-progression-prediction/discussion/421414)**

* **アプローチ:** MLPアンサンブル。タンパク質データはNPX値の患者内比率として限定的に使用。訪問月関連の特徴量を重視。
* **アーキテクチャ:** MLP (異なる構造、パラメータ)。
* **アルゴリズム:** (損失、Optimizer、Scheduler不明)。
* **テクニック:**
    * **特徴量:** 訪問月メタ特徴、前回訪問からの期間、患者ごとの訪問回数、NPX値の患者内比率。
    * **データ構造:** 16ターゲット（4 UPDRS x 4予測期間）を予測するモデルと、予測期間を特徴量として4 UPDRSを予測するモデルの両方を試行。
    * **学習データ:** 特定の訪問月（0, 6, 12, 18, 24, 36, 48, 60, 72, 84）のデータのみ使用。
    * **アンサンブル:** 異なるラベル数、ネットワーク構造、パラメータを持つ複数のMLPモデルをブレンド。

**[3位](https://www.kaggle.com/competitions/amp-parkinsons-disease-progression-prediction/discussion/412866)**

* **アプローチ:** 患者グルーピングと、血液検査データから生成した特徴ラベルに基づくルールベースの調整。
* **アーキテクチャ:** ベースモデルは不明（LGBMも試したが不採用）。最終的には特徴ラベルの係数をグリッドサーチで決定。
* **アルゴリズム:** グリッドサーチ。
* **テクニック:**
    * **患者グルーピング:** 最小訪問間隔（6ヶ月 or 18ヶ月 vs 12ヶ月以上）で「非健康(Unhealthy)」と「健康(Healthy)」に分割。
    * **特徴ラベル生成:** 「非健康」グループに対し、タンパク質採取頻度（6ヶ月目、12ヶ月目）やUniProtのユニーク数、ペプチド変化量に基づいて、重症度を示唆する9種類のバイナリラベルを作成。
    * **モデリング:** ベースとなる予測値（モデル不明）に対し、生成した特徴ラベルを用いて係数を調整。係数はTrain+Public LBの両方で改善が見られるものを採用し、グリッドサーチで最適化。

**[4位](https://www.kaggle.com/competitions/amp-parkinsons-disease-progression-prediction/discussion/412580)**

* **アプローチ:** 単一モデル（RAPIDS cuML SVR または TensorFlow MLP）。**血液検査データ未使用**。患者訪問日の情報に基づく特徴エンジニアリング。
* **アーキテクチャ:** SVR (RAPIDS cuML)、MLP (10隠れ層 x 24ユニット, ReLU)。
* **アルゴリズム:** SVR: (デフォルト)。MLP: MAE Loss。Adam Optimizer。
* **テクニック:**
    * **特徴量:** 訪問月 (`visit_month`) と、各基準訪問月 (0, 6, 12, ..., 84) における訪問有無を示す特徴量 (`v0`, `v6`, ...)。訪問有無不明の場合は-1とする。
    * **キーポイント:** 患者の訪問頻度とUPDRSスコアの間に強い正の相関があることを発見。
    * **データ作成:** 元の各行を、予測期間（0, 6, 12, 24ヶ月後）に応じた4つの新しい行に変換し、各行に対応する訪問有無特徴量を設定。
    * **学習:** MLPはAdam (LR=1e-3 -> 1e-4) で30エポック学習。Dropout、BatchNorm不使用。

**[5位](https://www.kaggle.com/competitions/amp-parkinsons-disease-progression-prediction/discussion/412702)**

* **アプローチ:** 患者グルーピングに基づき、グループごとに線形回帰またはIsotonic Regressionを適用。**血液検査データ未使用**。
* **アーキテクチャ:** 線形回帰、Isotonic Regression。
* **アルゴリズム:** 標準的な回帰アルゴリズム。
* **テクニック:**
    * **患者グルーピング:** 患者を訪問パターンから3グループに分類。特に、最初の非ゼロ訪問月が12ヶ月目である患者を「コントロール群（健康）」として識別。
    * **モデリング:** 識別されたグループと予測対象月に基づいて、線形回帰またはIsotonic Regressionによる予測値を使い分ける。
    * **特徴量:** グループ識別子、予測対象月のみ。

**[8位](https://www.kaggle.com/competitions/amp-parkinsons-disease-progression-prediction/discussion/412799)**

* **アプローチ:** 患者グルーピングと区分線形回帰。
* **アーキテクチャ:** 区分線形回帰モデル。
* **アルゴリズム:** 最小二乗法 (または類似の最適化手法)。
* **テクニック:**
    * **患者グルーピング:** **最小訪問月差分** (6ヶ月 vs 12ヶ月) を用いて「患者群」と「コントロール群」を識別。異常値(差分5ヶ月)や一部データ(差分3, 36ヶ月を6ヶ月に変換)を除外/変換。
    * **モデリング:** グループごとに区分線形関数 (`y = a + b*x + c*max(0, x-60)`) をフィッティングし、UPDRSスコアを予測。`updrs_4` のみ60ヶ月以降をクリップ。
    * **初期ループ:** 初回訪問時などグループ判別不能な場合は、全データで学習した共通の係数を使用。過去データが蓄積され次第、グループ別係数に切り替え。

**[9位](https://www.kaggle.com/competitions/amp-parkinsons-disease-progression-prediction/discussion/413127)**

* **アプローチ:** ルールベースの患者分割と、複数モデルの重み付きアンサンブル。**血液検査データは最終的に不採用**。
* **アーキテクチャ:** 線形回帰、CatBoost Regressor (Huber損失)、CatBoost Regressor (MAE損失)。
* **アルゴリズム:** 線形回帰、CatBoost。
* **テクニック:**
    * **患者分割（ルールベース）:** 「健康な患者」（UPDRS低値、隔年訪問パターン）を特定し、モデリング対象から除外して予測値を低く設定する（？詳細は不明瞭）。
    * **特徴量:** 基本的に訪問月のみ。
    * **学習データ:** 健康患者や異常値（5ヶ月目訪問、0ヶ月目のみ）を除外してモデル学習。補足データは使用。
    * **アンサンブル:** 3つの回帰モデル（線形回帰、CatBoost Huber, CatBoost MAE）の結果を重み付き平均。
    * **CV:** GroupKFold（ターゲット分布を揃える）。
    * **モデル選択:** CVとLBの両方が改善するアプローチを慎重に採用。




