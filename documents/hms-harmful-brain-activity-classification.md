---
tags:
  - Kaggle
startdate: 2024-01-10
enddate: 2024-04-09
---
# HMS - Harmful Brain Activity Classification
https://www.kaggle.com/competitions/hms-harmful-brain-activity-classification

**全体的な傾向:**

このコンペでは、脳波（EEG）データを用いて、有害な脳活動を分類することが目的となっています。上位解法では、**2D画像としてのスペクトログラム**と、**raw（時系列）EEG信号**の両面からアプローチするマルチモーダルな戦略が取られています。さらに、データの前処理（フィルタリング、ダブルバナナモンタージュ、クリッピングなど）や、複数のウィンドウ（例：50秒、10秒など）を活用することで、信号の局所情報とグローバルな特徴の両方を捉える工夫が見られます。また、クロスバリデーション、データ拡張、そしてエンサンブルによる最終的なブレンドが共通して実施され、各モデルの多様性を活かした最適化が図られています。

**各解法の詳細:**

**1位 **

- **アプローチ:**  
  複数のサブモデルを組み合わせ、スペクトラム画像を処理する3D-CNN（x3d-l）モデル、2D画像としてraw EEGを扱うEfficientNetB5ベースのモデル、さらに両者を統合したダブルヘッドモデルのエンサンブルにより最終予測を実現。

- **アーキテクチャ:**  
  - 3D-CNN (x3d-l) を用いたスペクトログラムモデル  
  - EfficientNetB5 をベースにした2Dモデル（raw EEG信号を画像化）  
  - 複数モデルの出力を結合するエンサンブル手法

- **アルゴリズム/テクニック:**  
  - EEG信号の前処理として、**ダブルバナナモンタージュ**、0.5–20Hzのフィルタ、±1024でのクリッピング  
  - **STFT** を用いてスペクトログラムを生成し、異なる時間ウィンドウ（50秒と10秒）の情報を抽出  
  - **グループK-fold** を用いたクロスバリデーション  
  - 2段階のトレーニング（Stage1とStage2）と、複数モデルの**重み付きエンサンブル**

---

**2位**

- **アプローチ:**  
  2Dと3DのCNNモデルを併用し、位置情報を保持しながらスペクトラム画像とraw EEG信号の両方から特徴抽出。MNEライブラリとscipy.signalによるフィルタリングの違いも活用して多様性を持たせる。

- **アーキテクチャ:**  
  - 3D-CNN（x3d-l）とEfficientNetB5を組み合わせたハイブリッドモデル  
  - raw EEGを画像化して処理する2Dモデル

- **アルゴリズム/テクニック:**  
  - **フィルタリング:** MNEによるフィルタとButterフィルタ（scipy.signal）を使い、前処理に多様性を持たせる  
  - **スペクトログラム生成:** STFTパラメータの違いによる2種類のモデル（x3d-lとoneimage）  
  - **データ拡張:** ミラー、左右フリップ、時間ウィンドウのランダムシフト  
  - **エンサンブル:** 複数のスペクトラムモデルとraw EEGモデルの融合、線形層による最終ブレンド

---

**3位**

- **アプローチ:**  
  2Dモデル（pretrained CNN系）と、1Dの軽量CNN＋Squeezeformerブロックを組み合わせたエンサンブルで、信号の時間軸情報と周波数成分の両方を学習。

- **アーキテクチャ:**  
  - 2Dモデル：Melスペクトログラムから抽出した画像を扱うPretrained 2D-CNN  
  - 1Dモデル：1D-CNNにSqueezeformerブロックを組み込んだアーキテクチャ

- **アルゴリズム/テクニック:**  
  - **データ選別:** 高投票数（vote>=10）のデータに注力し、冗長な拡張データをフィルタリング  
  - **拡張:** タイムシフト、左右フリップ、複数ウィンドウの利用  
  - **学習:** それぞれのモデルを独立に学習した後、エンサンブルによる予測平均化

---

**4位**

- **アプローチ:**  
  主に2Dスペクトログラムモデルを用い、Swin Transformer v2などの最新のTransformerベースのアーキテクチャを活用し、データの順序情報や局所的特徴を学習。

- **アーキテクチャ:**  
  - Swin Transformer v2 largeを中心とした2Dモデル  
  - 複数のスペクトログラム生成パラメータのバリエーションモデルのエンサンブル

- **アルゴリズム/テクニック:**  
  - **スペクトログラム生成:** EEGデータからクロップしたウィンドウの中心部（例：10秒）を「ズーム」して特徴抽出  
  - **エンサンブル:** Nelder-Meadや単層NNによるエンサンブル重み学習  
  - **投票数に基づくデータ分割:** vote>=10のデータに基づいてモデルを最適化

---

**5位**

- **アプローチ:**  
  複数のチームのアプローチを統合し、各チームが独自に開発した1D・2Dモデルのエンサンブルを構築。

- **アーキテクチャ:**  
  - 1Dモデルと2Dモデル（CNNベース）のハイブリッド  
  - 各チームが異なる前処理や特徴抽出手法を用いており、最終的にエンサンブルで融合

- **アルゴリズム/テクニック:**  
  - **前処理:** 各モデルで異なるフィルタやウィンドウ設定を採用  
  - **エンサンブル:** 各モデルの出力を適切な重みで融合  
  - **グループK-fold** を利用した安定したクロスバリデーション

---

**6位**

- **アプローチ:**  
  マルチモーダルな入力（Kaggleスペクトログラム、EEGスペクトログラム、raw EEGの50秒・10秒）をそれぞれ専用のバックボーンで処理し、最終的に統合することで精度を向上。

- **アーキテクチャ:**  
  - 各入力（Kaggleスペクトログラム、EEGスペクトログラム、raw EEG）のための個別バックボーン（例：Swin Transformer、CNN系）  
  - マルチヘッド構造で各特徴を統合する最終層

- **アルゴリズム/テクニック:**  
  - **前処理:** NaN除去、投票数に基づくデータの選別、ダブルバナナモンタージュなど  
  - **学習:** グループK-foldによるデータ分割、2段階学習、各入力ごとのランダムなタイムオフセット  
  - **エンサンブル:** 複数入力を統合したモデルの学習と、Test Time Augmentation（TTA）の活用

---

**7位**

- **アプローチ:**  
  2D raw EEG画像と2Dスペクトログラムの2種類の入力データを用い、最新のCNNベース（ConvNeXt、MaxViT）で特徴抽出し、エンサンブルする。

- **アーキテクチャ:**  
  - raw EEG信号を再構成（例：20×500の分割＋ストライド処理）して2D画像化  
  - STFTを用いたスペクトログラム生成  
  - それぞれの入力に対してConvNeXtやMaxViTを採用

- **アルゴリズム/テクニック:**  
  - **前処理:** 信号の再構成、対数変換による正規化  
  - **多様性の確保:** 異なるウィンドウサイズやストライドを利用した画像生成  
  - **エンサンブル:** 2種類のデータソースを組み合わせた予測

---

**8位**

- **アプローチ:**  
  単一モデルでGoldメダルを狙うため、3種類の入力（2Dスペクトログラム、2D波形プロット、1D raw EEG）を統合した「メガモデル」を構築し、擬似ラベルを活用して低投票データも補強。

- **アーキテクチャ:**  
  - 2D入力にはTiny ViT（ビジョントランスフォーマー系）  
  - 1D入力にはEegNet-1Dなど、各入力ごとに専用バックボーン  
  - 各モデルの中間層を連結し、新たなヘッドで再学習

- **アルゴリズム/テクニック:**  
  - **前処理:** MNEライブラリを用いたフィルタリング、各種データ拡張（brain flip、waveform crop/rescale、frequency dropout など）  
  - **サンプリング:** EEG IDごとにランダムにサンプルを選択し、各エポックで入力を変化  
  - **擬似ラベル:** 投票数が低いデータに対して、既存モデルの予測を利用したラベル補完  
  - **エンドツーエンド学習:** 3種類の入力を統合して単一モデルとして学習

---

**9位**

- **アプローチ:**  
  多数の2Dモデルをエンサンブルし、最適なブレンド重みをL-BFGS-Bなどの最適化手法で求めることで、個々のモデルの弱点を補完。

- **アーキテクチャ:**  
  - 複数のエンコーダ（例：1D LSTM、WaveNet、2Dスペクトログラム用CNN、Kaggleスペクトrogram用CNN）を組み合わせた複合モデル  
  - 最終的に各エンコーダの出力を線形層で融合し、最終予測を実施

- **アルゴリズム/テクニック:**  
  - **特徴抽出:** 生データとスペクトログラムから個別に特徴を抽出し、注意機構で統合  
  - **補助学習:** コントラスト学習やNaN予測の補助損失による精度向上  
  - **エンサンブル最適化:** L-BFGS-Bなどを用いた高速かつ効率的なエンサンブル重みの最適化
