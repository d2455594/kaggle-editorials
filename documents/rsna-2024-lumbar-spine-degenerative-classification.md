---
tags:
  - Kaggle
  - 物体検出
  - セグメンテーション
  - 画像認識処理
startdate: 2024-05-17
enddate: 2024-10-09
---
# RSNA 2024 Lumbar Spine Degenerative Classification
https://www.kaggle.com/competitions/rsna-2024-lumbar-spine-degenerative-classification

**全体的な傾向:**

このコンペでは、腰椎のMRI画像から椎間板ヘルニアや脊柱管狭窄などの変性疾患の重症度を分類することが課題です。上位解法は、大きく分けて2つのステージで構成されています。最初のステージでは、病変領域のキーポイント（座標）を検出し、2番目のステージでは、その領域を切り出した画像を用いて疾患の重症度を分類します。3D CNN、2D CNN、2.5D CNN、Transformer、LSTM、Attention機構など、多様なアーキテクチャが用いられ、データ拡張、アンサンブル学習、ラベルノイズへの対処などが重要なテクニックとして活用されています。

**各解法の詳細:**

**1位**

- **アプローチ:** 2段階アプローチ：テストラベル座標の作成と重症度の予測。最初の段階は、インスタンス番号予測と座標予測に分離。3種類のモデル（インスタンス番号予測、座標予測、重症度予測）を使用。
- **アーキテクチャ:**
    - **インスタンス番号予測 (矢状断):** 3D ConvNeXt。
    - **座標予測 (矢状断/軸位断):** 2Dエンコーダ（ConvNeXt-base、Efficientnet-v2-l）+レベル分離ヘッド。
    - **インスタンス番号予測 (軸位断):** Hengck23氏の方法を借用。
    - **重症度予測:** 2.5Dモデル、AttentionベースMIL（Multi-Instance Learning）、bi-LSTM。
- **アルゴリズム:** L1損失、交差エントロピー損失、AdamWオプティマイザ。
- **テクニック:**
    - **データ前処理:** ボリュームの正規化、DICOMメタデータによるソートとパディング、座標ラベルの正規化、画像のクロッピング（座標に基づく）、データ拡張（ランダムシフト、回転、明るさ、コントラストなど）。
    - **1段階目:** 回帰と分類の2つのタスクでインスタンス番号を予測。中央のインスタンス番号を持つ5つの画像を使用して座標を予測。軸位断のインスタンス番号予測にはHengck23氏の方法を使用。
    - **2段階目:** MIL（Attentionベース）による重症度分類。bi-LSTMと補助損失の追加。
    - **アンサンブル:** 中央値（インスタンス番号）、平均（座標）、重み付き平均（重症度）。

**2位**

- **アプローチ:** 軸位断と矢状断で別々のモデルを訓練し、各ターゲットに対して個別のモデルを作成。ノイズの多いラベルデータを除去し、分類モデルを再訓練。最終的な予測は、個々の予測の単純なブレンドと小さな後処理。
- **アーキテクチャ:** YOLOX（関心領域推定）、ConvNeXt Small（軸位断分類）、Timmモデル（矢状断スライス分類）、MILモデル（5画像入力、ConvNeXt Smallバックボーン）。
- **アルゴリズム:** StratifiedGroupKFold、AdamWオプティマイザ。
- **テクニック:**
    - **軸位断:** スライス分類（レベル予測）、YOLOXによる関心領域推定、ConvNeXt Smallによる重症度分類（脊椎と非脊椎で異なる扱い）。
    - **矢状断:** スライス分類（脊椎と関節突起間ターゲット）、YOLOX（Brendan氏のデータセットで訓練）による関心領域推定、水平方向のレベル分割とクロッピング、MILモデル（5スライス入力、ConvNeXt Smallバックボーン）による分類。
    - **ノイズ除去:** アンサンブルOOFを使用して損失の高いサンプルを除去。
    - **後処理:** 脊椎の重症度の最高予測値を1.25倍。
    - **アンサンブル:** メンバーの予測の重み付き平均。

**3位**

- **アプローチ:** 2段階パイプライン：各椎間板レベルでの矢状断画像のクロッピングと、椎間孔狭窄と関節突起間狭窄の重症度を分類するためのセンター分類器とサイド分類器の使用。
- **アーキテクチャ:** CenterNet（椎間板レベルと脊柱管のキーポイント検出）、2Dエンコーダ（ResNet、MNasNet、EfficientNet、ConvNeXt、MaxViT）+ Attention（センター/サイド分類器）。
- **アルゴリズム:** AdamWオプティマイザ、OneCycleLRスケジューラ、Cross-Entropy損失（重み付き）、Mixup（オプション）。
- **テクニック:**
    - **1段階目:** CenterNetによる椎間板レベルと脊柱管のキーポイント検出、キーポイントに基づく画像のクロッピング（矢状断と軸位断）。軸位断スライスの椎間板レベルへの割り当て。
    - **2段階目:** センター分類器（脊柱管狭窄）とサイド分類器（椎間孔狭窄、関節突起間狭窄）による重症度分類。複数の入力スライス、Attention機構、補助損失、テスト時拡張（TTA）。
    - **検証戦略:** StratifiedKFold（moderate以上の症例数、study_id）。
    - **疑似ラベリング:** オプション。
    - **アンサンブル:** 単純平均（30モデル）。
    - **後処理:** 脊柱管狭窄のロジットに温度スケーリング（0.91）。

**4位**

- **アプローチ:** 関心領域（症状のある部位）のキーポイントを検出し、周囲のクロップを入力として分類モデルを構築。スタッキングモデルで結果を洗練。
- **アーキテクチャ:** 2.5D CNN + LSTM（椎間板レベル検出）、UNet（キーポイント検出）、caformer_s18、convnext_tiny、resnetrs50、swinv2_tiny（分類モデルバックボーン）、Transformerエンコーダ、MLP（スタッキング）。
- **アルゴリズム:** BCELoss、DICELoss、AdamWオプティマイザ、Nelder-Mead（スタッキングの重み最適化）。
- **テクニック:**
    - **キーポイント検出:** 椎間板レベル検出、軸位断/矢状断T1/T2のキーポイント検出（2.5D CNN + LSTM、UNet）。矢状断のキーポイント検出（tattaka）。
    - **分類モデル:** マルチビュー入力、マルチコンディション出力モデル（tattaka）、シングルビュー入力、シングルコンディション出力モデル（yu4u）。クロップサイズはキーポイント間の距離に基づく。TransformerエンコーダとAttention Pooling。
    - **アンサンブルとスタッキング:** MLPスタッキング（Nelder-Mead最適化）、LightGBMとXGBoostスタッキング。

**5位**

- **アプローチ:** ヒートマップベースの検出、ガウス拡大ラベル、外部データセットを利用した1段階目と、2.5Dモデル（CNN + RNN）、レベルごとのシーケンスモデリング、2段階トレーニングを用いた2段階目。
- **アーキテクチャ:** 2D UNet（EfficientNet-B5バックボーン）、Transformer/LSTM（シーケンスモデリング）、ConvNeXt（2段階目CNNバックボーン）。
- **アルゴリズム:** AdamWオプティマイザ、カットミックス。
- **テクニック:**
    - **1段階目:** ヒートマップベースのキーポイント検出（25クラス）、ガウスフィルタによるラベル拡張、外部データセット（Brendan氏のデータセット）の利用。
    - **2段階目:** キーポイントに基づくクロッピング（±2スライス、±32ピクセル）、2.5Dモデル（CNN + RNN）によるレベルごとのシーケンスモデリング、クラス間の関係をモデル化する追加モジュール。
    - **データ拡張:** カットミックス（p=1.0）。
    - **トレーニング:** 2段階トレーニング（AUC最大化のための事前トレーニング、コンペティションメトリック最適化のためのファインチューニング）。
    - **アンサンブル:** 多様なバックボーンのアンサンブル、TTAライクなアンサンブル。

**6位**

- **アプローチ:** 研究またはシリーズレベルで個々の椎間板レベルごとにトレーニングされた複数のモデルのアンサンブル。最初の段階で元のMRIのクロップを分離し、クロップのシーケンスを使用して状態の重症度を予測。最終結果は、コンペティションメトリックを直接最適化するMLPモデルを使用して集約。
- **アーキテクチャ:** 2D CNN、RNN（2.5Dモデル）、MLP。
- **テクニック:**
    - **データ準備:** 椎間板レベルごとの画像のクロッピング。
    - **モデル:** 2D CNN（EfficientNet）、RNN（重症度予測）、MLP（予測の集約）。
    - **トレーニング:** シリーズレベルまたは個々の椎間板レベルでトレーニング。
    - **アンサンブル:** MLPによる予測の集約。

**7位**

- **アプローチ:** 1段階と2段階のアンサンブル。1段階目はキーポイント回帰（2Dと3D）、2段階目はキーポイントでクロップし、特徴空間で3つのビューを融合するモデルと、単一ビューで3種類の状態を予測するモデル。
- **アーキテクチャ:** Timmモデル（2Dキーポイント回帰）、Timm-3Dモデル（3Dキーポイント回帰）、2.5Dモデル（CNN + LSTM + Attention）、ConvNeXt。
- **テクニック:**
    - **1段階目:** 2Dおよび3Dキーポイント回帰（矢状断と軸位断）。ITKのベースラインで検索されたバックボーンを使用。
    - **2段階目_モデル1:** 矢状断（2Dキーポイント）と軸位断（3Dキーポイント）のキーポイントを使用し、特徴空間で3つのビューを融合。
    - **2段階目_モデル2:** 3D ROI画像をXYZポイントに基づいてクロップ。軸位断では信頼度の高い検出のみを使用。
    - **アンサンブル:** stage2_model1とstage2_model2を様々なバックボーンとTTA（矢状断の水平反転、軸位断の垂直反転）でアンサンブル。

**8位**

- **アプローチ:** 2D分類器と1D分類器を組み合わせたアーキテクチャ。1段階目の特徴抽出では、注意機構のようにヒートマップを重みとして使用。SSL（自己教師あり学習）とリラベリングも試行。
- **アーキテクチャ:** 2D分類器（CNNバックボーン）、1D分類器（2D分類器の出力をスタック）、ConvNeXt。
- **テクニック:**
    - **1段階目:** 2D画像をCNNバックボーンで処理し、ヒートマップを生成（検出器として使用）。ヒートマップを特徴抽出の重みとして使用。
    - **2段階目:** 1段階目の出力をスタックし、1D CNNで最終予測。
    - **SSL:** xyz座標を使用してマルチビュー類似性を学習。
    - **リラベリング:** アノテーションツールの作成とラベルの修正を試行。

**9位**

- **アプローチ:** ガウスヒートマップベースのキーポイント検出（DeepLabV3Plus）と、レベルごとのROI分類（2.5Dモデル + GRUヘッド + ResNet18/Swin-Tiny/ConvNeXt-Nanoバックボーン）の2段階アプローチ。
- **アーキテクチャ:** DeepLabV3Plus（キーポイント検出）、ResNet18、Swin-Tiny、ConvNeXt-Nano（分類モデルバックボーン）、GRUヘッド。
- **アルゴリズム:** AdamWオプティマイザ、CosineAnnealingLRスケジューラ、MSE損失（キーポイント検出）、交差エントロピー損失（分類）。
- **テクニック:**
    - **1段階目:** シリーズタイプごとにDeepLabV3Plusでキーポイントを検出（ガウスヒートマップ）。
    - **2段階目:** キーポイントを中心としたROIをクロップし、2.5Dモデル（CNN + GRU）でレベルごとに分類。分割モデル（個々の状態を予測）とグローバルモデル（すべての状態を予測）を使用。
    - **データ拡張:** 回転、せん断、チャンネルシャッフル、シャープニング/モーションブラー。
    - **アンサンブル:** 分割モデルとグローバルモデルを、異なる特徴抽出器（ResNet18、Swin-Tiny、ConvNeXt-Nano）でアンサンブル。

**10位**

- **アプローチ:** 多項式近似アプローチ。トランジットの入り口/出口の瞬間を切り取らずに、信号全体を使用。
- **テクニック:**
    - **トランジットゾーン検出:** スライディングウィンドウでの導関数計算による強度変化の検出、導関数の極値に基づくトランジットの中点の推定、線形セクションによるトランジット開始の正確な決定。
    - **トランジット回復関数:** 滑らかな関数（Desmosで定義）によるトランジットのモデル化。
    - **予測収集パイプライン:** 波長ビニング集約とランダムサンプルインデックス選択によるターゲットの計算、トランジットの開始/終了/期間のパラメータ計算、正規化された信号での多項式フィッティング、波長インデックスの反復処理とサブサンプルの最適化。
    - **シグマ推定:** 勾配ブースティングによる予測特徴量からのシグマ推定（「良い」波長と「ノイズの多い」波長で別々に予測）。